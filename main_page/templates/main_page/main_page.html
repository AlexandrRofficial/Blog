{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blog</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>

<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="{% url 'main_page' %}">Blog</a>

        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">

                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <span class="nav-link text-light">
                            {{ user.username }} ({{ user.role }})
                        </span>
                    </li>

                    {% if user.role == 'author' or user.role == 'admin' %}
                        <li class="nav-item">
                            <a class="nav-link btn btn-success text-white ms-2"
                               href="{% url 'article_create' %}">
                                + Add Article
                            </a>
                        </li>
                    {% endif %}

                    <li class="nav-item">
                        <a class="nav-link text-danger ms-2"
                           href="{% url 'logout' %}">
                            Logout
                        </a>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Login</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'register' %}">Register</a>
                    </li>
                {% endif %}

            </ul>
        </div>
    </div>
</nav>

<div class="container">

    <h1 class="text-center mb-4">Articles</h1>

    <div class="mb-4 text-center">
        <a href="?sort=latest"
        class="btn btn-outline-primary {% if sort == 'latest' %}active{% endif %}">
            Latest articles
        </a>

        <a href="?sort=popular"
        class="btn btn-outline-success {% if sort == 'popular' %}active{% endif %}">
            Popular articles
        </a>
    </div>

    {% for article in articles %}
        <div class="card mb-4 shadow-sm">
            <div class="card-body">

                <h3>{{ article.title }}</h3>

                <p class="text-muted">
                    by {{ article.author.username }} |
                    {{ article.created_at|date:"d.m.Y H:i" }}
                </p>

                <p>{{ article.content|truncatewords:30 }}</p>

                <p>
                    <strong>Category:</strong>
                    {{ article.category.name }} 
                </p>

                <p>
                    <strong>Tags:</strong>
                    {% for tag in article.tags.all %}
                        <span class="badge bg-secondary">
                            #{{ tag.name }}
                        </span>
                    {% empty %}
                        <span class="text-muted">No tags</span>
                    {% endfor %}
                </p>

                <p>
                ‚ù§Ô∏è {{ article.like_count }} likes
                </p>

                {% if user.is_authenticated %}
                    <a href="{% url 'article_like' article.id %}"
                        class="btn btn-sm btn-outline-danger">
                        Like / Unlike
                    </a>
                {% endif %}

                <div class="mt-3 d-flex justify-content-between align-items-center">

                    <a href="{% url 'article_detail' article.id %}"
                    class="btn btn-sm btn-primary">
                        View article
                    </a>

                    <span class="text-muted">
                        üí¨ {{ article.comment_count }} comments
                    </span>

                </div>  

                {% if user.is_authenticated %}
                    {% if user == article.author or user.role == 'admin' %}
                        <div class="mt-3">
                            <a href="{% url 'article_edit' article.id %}"
                               class="btn btn-sm btn-warning">
                                Edit
                            </a>

                            <a href="{% url 'article_delete' article.id %}"
                               class="btn btn-sm btn-danger">
                                Delete
                            </a>
                        </div>
                    {% endif %}
                {% endif %}

            </div>
        </div>

    {% empty %}
        <p class="text-center text-muted">
            No articles yet
        </p>
    {% endfor %}

    <h1 class="text-center mb-4">Categories</h1>

    {% if user.role == 'admin' %}
        <a href="{% url 'category_create' %}" class="btn btn-success mb-3">
            + Add category
        </a>
    {% endif %}

    <ul class="list-group mb-5">
    {% for category in categories %}
        <li class="list-group-item d-flex justify-content-between">
            {{ category.name }}

            {% if user.role == 'admin' %}
                <a href="{% url 'category_delete' category.id %}" class="btn btn-sm btn-danger">
                    Delete
                </a>
            {% endif %}
        </li>
    {% endfor %}
    </ul>


    <h1 class="text-center mb-4">Tags</h1>

    {% if user.role == 'admin' %}
        <a href="{% url 'tag_create' %}" class="btn btn-success mb-3">
            + Add tag
        </a>
    {% endif %}

    <ul class="list-group">
    {% for tag in tags %}
        <li class="list-group-item d-flex justify-content-between">
            #{{ tag.name }}

            {% if user.role == 'admin' %}
                <a href="{% url 'tag_delete' tag.id %}" class="btn btn-sm btn-danger">
                    Delete
                </a>
            {% endif %}
        </li>
    {% endfor %}
    </ul>

    <h1 class="text-center mb-4">Announcements</h1>

    {% if user.is_authenticated and user.role == 'admin' %}
        <a href="{% url 'announcement_create' %}"
        class="btn btn-sm btn-success mb-3">
            + Add announcement
        </a>
    {% endif %}

    {% for ann in announcements %}
        <div class="alert alert-warning">

            <strong>{{ ann.title }}</strong>
            <p>{{ ann.content|truncatewords:15 }}</p>

            {% if user.is_authenticated and user.role == 'admin' %}
                <div class="mt-2">
                    <a href="{% url 'announcement_edit' ann.id %}"
                    class="btn btn-sm btn-outline-warning">
                        Edit
                    </a>

                    <a href="{% url 'announcement_delete' ann.id %}"
                    class="btn btn-sm btn-outline-danger">
                        Delete
                    </a>
                </div>
            {% endif %}
        </div>
    {% empty %}
        <p class="text-muted">No announcements</p>
    {% endfor %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>